// Code generated by conjure-go. DO NOT EDIT.

package api

import (
	"context"
	"fmt"
	"net/url"

	"github.com/nominal-io/nominal-api-go/internal/conjureerrors"
	"github.com/palantir/conjure-go-runtime/v2/conjure-go-client/httpclient"
	"github.com/palantir/pkg/bearertoken"
	werror "github.com/palantir/witchcraft-go-error"
)

// The secrets service provides functionality for creating and retrieving customer secrets (e.g. influx passwords, API keys, etc)
type SecretServiceClient interface {
	// Create a new secret. The secret value is immutable after creation.
	Create(ctx context.Context, authHeader bearertoken.Token, requestArg CreateSecretRequest) (Secret, error)
	// Get secret by rid.
	Get(ctx context.Context, authHeader bearertoken.Token, ridArg SecretRid) (Secret, error)
	// Get secrets by a set of rids.
	GetBatch(ctx context.Context, authHeader bearertoken.Token, requestArg GetSecretsRequest) (GetSecretsResponse, error)
	// Update a secret by rid.
	Update(ctx context.Context, authHeader bearertoken.Token, ridArg SecretRid, requestArg UpdateSecretRequest) (Secret, error)
	/*
	   Delete a secret by rid. This is a permanent deletion. To perform a soft delete,
	   use the archive endpoint.
	*/
	Delete(ctx context.Context, authHeader bearertoken.Token, ridArg SecretRid) error
	// Archive a secret by rid.
	Archive(ctx context.Context, authHeader bearertoken.Token, ridArg SecretRid) error
	// Unarchive a secret by rid.
	Unarchive(ctx context.Context, authHeader bearertoken.Token, ridArg SecretRid) error
	// Returns metadata about secrets that match a given query.
	Search(ctx context.Context, authHeader bearertoken.Token, requestArg SearchSecretsRequest) (SearchSecretsResponse, error)
}

type secretServiceClient struct {
	client httpclient.Client
}

func NewSecretServiceClient(client httpclient.Client) SecretServiceClient {
	return &secretServiceClient{client: client}
}

func (c *secretServiceClient) Create(ctx context.Context, authHeader bearertoken.Token, requestArg CreateSecretRequest) (Secret, error) {
	var defaultReturnVal Secret
	var returnVal *Secret
	var requestParams []httpclient.RequestParam
	requestParams = append(requestParams, httpclient.WithRPCMethodName("Create"))
	requestParams = append(requestParams, httpclient.WithRequestMethod("POST"))
	requestParams = append(requestParams, httpclient.WithHeader("Authorization", fmt.Sprint("Bearer ", authHeader)))
	requestParams = append(requestParams, httpclient.WithPathf("/secrets/v1/secrets"))
	requestParams = append(requestParams, httpclient.WithJSONRequest(requestArg))
	requestParams = append(requestParams, httpclient.WithJSONResponse(&returnVal))
	requestParams = append(requestParams, httpclient.WithRequestConjureErrorDecoder(conjureerrors.Decoder()))
	if _, err := c.client.Do(ctx, requestParams...); err != nil {
		return defaultReturnVal, werror.WrapWithContextParams(ctx, err, "create failed")
	}
	if returnVal == nil {
		return defaultReturnVal, werror.ErrorWithContextParams(ctx, "create response cannot be nil")
	}
	return *returnVal, nil
}

func (c *secretServiceClient) Get(ctx context.Context, authHeader bearertoken.Token, ridArg SecretRid) (Secret, error) {
	var defaultReturnVal Secret
	var returnVal *Secret
	var requestParams []httpclient.RequestParam
	requestParams = append(requestParams, httpclient.WithRPCMethodName("Get"))
	requestParams = append(requestParams, httpclient.WithRequestMethod("GET"))
	requestParams = append(requestParams, httpclient.WithHeader("Authorization", fmt.Sprint("Bearer ", authHeader)))
	requestParams = append(requestParams, httpclient.WithPathf("/secrets/v1/secrets/%s", url.PathEscape(fmt.Sprint(ridArg))))
	requestParams = append(requestParams, httpclient.WithJSONResponse(&returnVal))
	requestParams = append(requestParams, httpclient.WithRequestConjureErrorDecoder(conjureerrors.Decoder()))
	if _, err := c.client.Do(ctx, requestParams...); err != nil {
		return defaultReturnVal, werror.WrapWithContextParams(ctx, err, "get failed")
	}
	if returnVal == nil {
		return defaultReturnVal, werror.ErrorWithContextParams(ctx, "get response cannot be nil")
	}
	return *returnVal, nil
}

func (c *secretServiceClient) GetBatch(ctx context.Context, authHeader bearertoken.Token, requestArg GetSecretsRequest) (GetSecretsResponse, error) {
	var defaultReturnVal GetSecretsResponse
	var returnVal *GetSecretsResponse
	var requestParams []httpclient.RequestParam
	requestParams = append(requestParams, httpclient.WithRPCMethodName("GetBatch"))
	requestParams = append(requestParams, httpclient.WithRequestMethod("POST"))
	requestParams = append(requestParams, httpclient.WithHeader("Authorization", fmt.Sprint("Bearer ", authHeader)))
	requestParams = append(requestParams, httpclient.WithPathf("/secrets/v1/secrets/batch"))
	requestParams = append(requestParams, httpclient.WithJSONRequest(requestArg))
	requestParams = append(requestParams, httpclient.WithJSONResponse(&returnVal))
	requestParams = append(requestParams, httpclient.WithRequestConjureErrorDecoder(conjureerrors.Decoder()))
	if _, err := c.client.Do(ctx, requestParams...); err != nil {
		return defaultReturnVal, werror.WrapWithContextParams(ctx, err, "getBatch failed")
	}
	if returnVal == nil {
		return defaultReturnVal, werror.ErrorWithContextParams(ctx, "getBatch response cannot be nil")
	}
	return *returnVal, nil
}

func (c *secretServiceClient) Update(ctx context.Context, authHeader bearertoken.Token, ridArg SecretRid, requestArg UpdateSecretRequest) (Secret, error) {
	var defaultReturnVal Secret
	var returnVal *Secret
	var requestParams []httpclient.RequestParam
	requestParams = append(requestParams, httpclient.WithRPCMethodName("Update"))
	requestParams = append(requestParams, httpclient.WithRequestMethod("PUT"))
	requestParams = append(requestParams, httpclient.WithHeader("Authorization", fmt.Sprint("Bearer ", authHeader)))
	requestParams = append(requestParams, httpclient.WithPathf("/secrets/v1/secrets/%s", url.PathEscape(fmt.Sprint(ridArg))))
	requestParams = append(requestParams, httpclient.WithJSONRequest(requestArg))
	requestParams = append(requestParams, httpclient.WithJSONResponse(&returnVal))
	requestParams = append(requestParams, httpclient.WithRequestConjureErrorDecoder(conjureerrors.Decoder()))
	if _, err := c.client.Do(ctx, requestParams...); err != nil {
		return defaultReturnVal, werror.WrapWithContextParams(ctx, err, "update failed")
	}
	if returnVal == nil {
		return defaultReturnVal, werror.ErrorWithContextParams(ctx, "update response cannot be nil")
	}
	return *returnVal, nil
}

func (c *secretServiceClient) Delete(ctx context.Context, authHeader bearertoken.Token, ridArg SecretRid) error {
	var requestParams []httpclient.RequestParam
	requestParams = append(requestParams, httpclient.WithRPCMethodName("Delete"))
	requestParams = append(requestParams, httpclient.WithRequestMethod("DELETE"))
	requestParams = append(requestParams, httpclient.WithHeader("Authorization", fmt.Sprint("Bearer ", authHeader)))
	requestParams = append(requestParams, httpclient.WithPathf("/secrets/v1/secrets/%s", url.PathEscape(fmt.Sprint(ridArg))))
	requestParams = append(requestParams, httpclient.WithRequestConjureErrorDecoder(conjureerrors.Decoder()))
	if _, err := c.client.Do(ctx, requestParams...); err != nil {
		return werror.WrapWithContextParams(ctx, err, "delete failed")
	}
	return nil
}

func (c *secretServiceClient) Archive(ctx context.Context, authHeader bearertoken.Token, ridArg SecretRid) error {
	var requestParams []httpclient.RequestParam
	requestParams = append(requestParams, httpclient.WithRPCMethodName("Archive"))
	requestParams = append(requestParams, httpclient.WithRequestMethod("PUT"))
	requestParams = append(requestParams, httpclient.WithHeader("Authorization", fmt.Sprint("Bearer ", authHeader)))
	requestParams = append(requestParams, httpclient.WithPathf("/secrets/v1/secrets/%s/archive", url.PathEscape(fmt.Sprint(ridArg))))
	requestParams = append(requestParams, httpclient.WithRequestConjureErrorDecoder(conjureerrors.Decoder()))
	if _, err := c.client.Do(ctx, requestParams...); err != nil {
		return werror.WrapWithContextParams(ctx, err, "archive failed")
	}
	return nil
}

func (c *secretServiceClient) Unarchive(ctx context.Context, authHeader bearertoken.Token, ridArg SecretRid) error {
	var requestParams []httpclient.RequestParam
	requestParams = append(requestParams, httpclient.WithRPCMethodName("Unarchive"))
	requestParams = append(requestParams, httpclient.WithRequestMethod("PUT"))
	requestParams = append(requestParams, httpclient.WithHeader("Authorization", fmt.Sprint("Bearer ", authHeader)))
	requestParams = append(requestParams, httpclient.WithPathf("/secrets/v1/secrets/%s/unarchive", url.PathEscape(fmt.Sprint(ridArg))))
	requestParams = append(requestParams, httpclient.WithRequestConjureErrorDecoder(conjureerrors.Decoder()))
	if _, err := c.client.Do(ctx, requestParams...); err != nil {
		return werror.WrapWithContextParams(ctx, err, "unarchive failed")
	}
	return nil
}

func (c *secretServiceClient) Search(ctx context.Context, authHeader bearertoken.Token, requestArg SearchSecretsRequest) (SearchSecretsResponse, error) {
	var defaultReturnVal SearchSecretsResponse
	var returnVal *SearchSecretsResponse
	var requestParams []httpclient.RequestParam
	requestParams = append(requestParams, httpclient.WithRPCMethodName("Search"))
	requestParams = append(requestParams, httpclient.WithRequestMethod("POST"))
	requestParams = append(requestParams, httpclient.WithHeader("Authorization", fmt.Sprint("Bearer ", authHeader)))
	requestParams = append(requestParams, httpclient.WithPathf("/secrets/v1/secrets/search"))
	requestParams = append(requestParams, httpclient.WithJSONRequest(requestArg))
	requestParams = append(requestParams, httpclient.WithJSONResponse(&returnVal))
	requestParams = append(requestParams, httpclient.WithRequestConjureErrorDecoder(conjureerrors.Decoder()))
	if _, err := c.client.Do(ctx, requestParams...); err != nil {
		return defaultReturnVal, werror.WrapWithContextParams(ctx, err, "search failed")
	}
	if returnVal == nil {
		return defaultReturnVal, werror.ErrorWithContextParams(ctx, "search response cannot be nil")
	}
	return *returnVal, nil
}

// The secrets service provides functionality for creating and retrieving customer secrets (e.g. influx passwords, API keys, etc)
type SecretServiceClientWithAuth interface {
	// Create a new secret. The secret value is immutable after creation.
	Create(ctx context.Context, requestArg CreateSecretRequest) (Secret, error)
	// Get secret by rid.
	Get(ctx context.Context, ridArg SecretRid) (Secret, error)
	// Get secrets by a set of rids.
	GetBatch(ctx context.Context, requestArg GetSecretsRequest) (GetSecretsResponse, error)
	// Update a secret by rid.
	Update(ctx context.Context, ridArg SecretRid, requestArg UpdateSecretRequest) (Secret, error)
	/*
	   Delete a secret by rid. This is a permanent deletion. To perform a soft delete,
	   use the archive endpoint.
	*/
	Delete(ctx context.Context, ridArg SecretRid) error
	// Archive a secret by rid.
	Archive(ctx context.Context, ridArg SecretRid) error
	// Unarchive a secret by rid.
	Unarchive(ctx context.Context, ridArg SecretRid) error
	// Returns metadata about secrets that match a given query.
	Search(ctx context.Context, requestArg SearchSecretsRequest) (SearchSecretsResponse, error)
}

func NewSecretServiceClientWithAuth(client SecretServiceClient, authHeader bearertoken.Token) SecretServiceClientWithAuth {
	return &secretServiceClientWithAuth{client: client, authHeader: authHeader}
}

type secretServiceClientWithAuth struct {
	client     SecretServiceClient
	authHeader bearertoken.Token
}

func (c *secretServiceClientWithAuth) Create(ctx context.Context, requestArg CreateSecretRequest) (Secret, error) {
	return c.client.Create(ctx, c.authHeader, requestArg)
}

func (c *secretServiceClientWithAuth) Get(ctx context.Context, ridArg SecretRid) (Secret, error) {
	return c.client.Get(ctx, c.authHeader, ridArg)
}

func (c *secretServiceClientWithAuth) GetBatch(ctx context.Context, requestArg GetSecretsRequest) (GetSecretsResponse, error) {
	return c.client.GetBatch(ctx, c.authHeader, requestArg)
}

func (c *secretServiceClientWithAuth) Update(ctx context.Context, ridArg SecretRid, requestArg UpdateSecretRequest) (Secret, error) {
	return c.client.Update(ctx, c.authHeader, ridArg, requestArg)
}

func (c *secretServiceClientWithAuth) Delete(ctx context.Context, ridArg SecretRid) error {
	return c.client.Delete(ctx, c.authHeader, ridArg)
}

func (c *secretServiceClientWithAuth) Archive(ctx context.Context, ridArg SecretRid) error {
	return c.client.Archive(ctx, c.authHeader, ridArg)
}

func (c *secretServiceClientWithAuth) Unarchive(ctx context.Context, ridArg SecretRid) error {
	return c.client.Unarchive(ctx, c.authHeader, ridArg)
}

func (c *secretServiceClientWithAuth) Search(ctx context.Context, requestArg SearchSecretsRequest) (SearchSecretsResponse, error) {
	return c.client.Search(ctx, c.authHeader, requestArg)
}

func NewSecretServiceClientWithTokenProvider(client SecretServiceClient, tokenProvider httpclient.TokenProvider) SecretServiceClientWithAuth {
	return &secretServiceClientWithTokenProvider{client: client, tokenProvider: tokenProvider}
}

type secretServiceClientWithTokenProvider struct {
	client        SecretServiceClient
	tokenProvider httpclient.TokenProvider
}

func (c *secretServiceClientWithTokenProvider) Create(ctx context.Context, requestArg CreateSecretRequest) (Secret, error) {
	var defaultReturnVal Secret
	token, err := c.tokenProvider(ctx)
	if err != nil {
		return defaultReturnVal, err
	}
	return c.client.Create(ctx, bearertoken.Token(token), requestArg)
}

func (c *secretServiceClientWithTokenProvider) Get(ctx context.Context, ridArg SecretRid) (Secret, error) {
	var defaultReturnVal Secret
	token, err := c.tokenProvider(ctx)
	if err != nil {
		return defaultReturnVal, err
	}
	return c.client.Get(ctx, bearertoken.Token(token), ridArg)
}

func (c *secretServiceClientWithTokenProvider) GetBatch(ctx context.Context, requestArg GetSecretsRequest) (GetSecretsResponse, error) {
	var defaultReturnVal GetSecretsResponse
	token, err := c.tokenProvider(ctx)
	if err != nil {
		return defaultReturnVal, err
	}
	return c.client.GetBatch(ctx, bearertoken.Token(token), requestArg)
}

func (c *secretServiceClientWithTokenProvider) Update(ctx context.Context, ridArg SecretRid, requestArg UpdateSecretRequest) (Secret, error) {
	var defaultReturnVal Secret
	token, err := c.tokenProvider(ctx)
	if err != nil {
		return defaultReturnVal, err
	}
	return c.client.Update(ctx, bearertoken.Token(token), ridArg, requestArg)
}

func (c *secretServiceClientWithTokenProvider) Delete(ctx context.Context, ridArg SecretRid) error {
	token, err := c.tokenProvider(ctx)
	if err != nil {
		return err
	}
	return c.client.Delete(ctx, bearertoken.Token(token), ridArg)
}

func (c *secretServiceClientWithTokenProvider) Archive(ctx context.Context, ridArg SecretRid) error {
	token, err := c.tokenProvider(ctx)
	if err != nil {
		return err
	}
	return c.client.Archive(ctx, bearertoken.Token(token), ridArg)
}

func (c *secretServiceClientWithTokenProvider) Unarchive(ctx context.Context, ridArg SecretRid) error {
	token, err := c.tokenProvider(ctx)
	if err != nil {
		return err
	}
	return c.client.Unarchive(ctx, bearertoken.Token(token), ridArg)
}

func (c *secretServiceClientWithTokenProvider) Search(ctx context.Context, requestArg SearchSecretsRequest) (SearchSecretsResponse, error) {
	var defaultReturnVal SearchSecretsResponse
	token, err := c.tokenProvider(ctx)
	if err != nil {
		return defaultReturnVal, err
	}
	return c.client.Search(ctx, bearertoken.Token(token), requestArg)
}
