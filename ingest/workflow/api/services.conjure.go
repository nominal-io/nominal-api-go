// Code generated by conjure-go. DO NOT EDIT.

package api

import (
	"context"
	"fmt"
	"net/url"

	"github.com/nominal-io/nominal-api-go/ingest/api"
	"github.com/nominal-io/nominal-api-go/internal/conjureerrors"
	"github.com/palantir/conjure-go-runtime/v2/conjure-go-client/httpclient"
	"github.com/palantir/pkg/bearertoken"
	werror "github.com/palantir/witchcraft-go-error"
)

type IngestInternalServiceClient interface {
	// Returns a single ingest job by RID.
	GetIngestJob(ctx context.Context, authHeader bearertoken.Token, ingestJobRidArg api.IngestJobRid) (api.IngestJob, error)
	// Updates the status of an ingest job.
	UpdateIngestJobStatus(ctx context.Context, authHeader bearertoken.Token, ingestJobRidArg api.IngestJobRid, statusArg api.IngestJobStatus) (api.IngestJobStatus, error)
}

type ingestInternalServiceClient struct {
	client httpclient.Client
}

func NewIngestInternalServiceClient(client httpclient.Client) IngestInternalServiceClient {
	return &ingestInternalServiceClient{client: client}
}

func (c *ingestInternalServiceClient) GetIngestJob(ctx context.Context, authHeader bearertoken.Token, ingestJobRidArg api.IngestJobRid) (api.IngestJob, error) {
	var defaultReturnVal api.IngestJob
	var returnVal *api.IngestJob
	var requestParams []httpclient.RequestParam
	requestParams = append(requestParams, httpclient.WithRPCMethodName("GetIngestJob"))
	requestParams = append(requestParams, httpclient.WithRequestMethod("GET"))
	requestParams = append(requestParams, httpclient.WithHeader("Authorization", fmt.Sprint("Bearer ", authHeader)))
	requestParams = append(requestParams, httpclient.WithPathf("/internal/ingest/v1/ingest-job/%s", url.PathEscape(fmt.Sprint(ingestJobRidArg))))
	requestParams = append(requestParams, httpclient.WithJSONResponse(&returnVal))
	requestParams = append(requestParams, httpclient.WithRequestConjureErrorDecoder(conjureerrors.Decoder()))
	if _, err := c.client.Do(ctx, requestParams...); err != nil {
		return defaultReturnVal, werror.WrapWithContextParams(ctx, err, "getIngestJob failed")
	}
	if returnVal == nil {
		return defaultReturnVal, werror.ErrorWithContextParams(ctx, "getIngestJob response cannot be nil")
	}
	return *returnVal, nil
}

func (c *ingestInternalServiceClient) UpdateIngestJobStatus(ctx context.Context, authHeader bearertoken.Token, ingestJobRidArg api.IngestJobRid, statusArg api.IngestJobStatus) (api.IngestJobStatus, error) {
	var defaultReturnVal api.IngestJobStatus
	var returnVal *api.IngestJobStatus
	var requestParams []httpclient.RequestParam
	requestParams = append(requestParams, httpclient.WithRPCMethodName("UpdateIngestJobStatus"))
	requestParams = append(requestParams, httpclient.WithRequestMethod("PUT"))
	requestParams = append(requestParams, httpclient.WithHeader("Authorization", fmt.Sprint("Bearer ", authHeader)))
	requestParams = append(requestParams, httpclient.WithPathf("/internal/ingest/v1/ingest-job/%s/status", url.PathEscape(fmt.Sprint(ingestJobRidArg))))
	requestParams = append(requestParams, httpclient.WithJSONRequest(statusArg))
	requestParams = append(requestParams, httpclient.WithJSONResponse(&returnVal))
	requestParams = append(requestParams, httpclient.WithRequestConjureErrorDecoder(conjureerrors.Decoder()))
	if _, err := c.client.Do(ctx, requestParams...); err != nil {
		return defaultReturnVal, werror.WrapWithContextParams(ctx, err, "updateIngestJobStatus failed")
	}
	if returnVal == nil {
		return defaultReturnVal, werror.ErrorWithContextParams(ctx, "updateIngestJobStatus response cannot be nil")
	}
	return *returnVal, nil
}

type IngestInternalServiceClientWithAuth interface {
	// Returns a single ingest job by RID.
	GetIngestJob(ctx context.Context, ingestJobRidArg api.IngestJobRid) (api.IngestJob, error)
	// Updates the status of an ingest job.
	UpdateIngestJobStatus(ctx context.Context, ingestJobRidArg api.IngestJobRid, statusArg api.IngestJobStatus) (api.IngestJobStatus, error)
}

func NewIngestInternalServiceClientWithAuth(client IngestInternalServiceClient, authHeader bearertoken.Token) IngestInternalServiceClientWithAuth {
	return &ingestInternalServiceClientWithAuth{client: client, authHeader: authHeader}
}

type ingestInternalServiceClientWithAuth struct {
	client     IngestInternalServiceClient
	authHeader bearertoken.Token
}

func (c *ingestInternalServiceClientWithAuth) GetIngestJob(ctx context.Context, ingestJobRidArg api.IngestJobRid) (api.IngestJob, error) {
	return c.client.GetIngestJob(ctx, c.authHeader, ingestJobRidArg)
}

func (c *ingestInternalServiceClientWithAuth) UpdateIngestJobStatus(ctx context.Context, ingestJobRidArg api.IngestJobRid, statusArg api.IngestJobStatus) (api.IngestJobStatus, error) {
	return c.client.UpdateIngestJobStatus(ctx, c.authHeader, ingestJobRidArg, statusArg)
}

func NewIngestInternalServiceClientWithTokenProvider(client IngestInternalServiceClient, tokenProvider httpclient.TokenProvider) IngestInternalServiceClientWithAuth {
	return &ingestInternalServiceClientWithTokenProvider{client: client, tokenProvider: tokenProvider}
}

type ingestInternalServiceClientWithTokenProvider struct {
	client        IngestInternalServiceClient
	tokenProvider httpclient.TokenProvider
}

func (c *ingestInternalServiceClientWithTokenProvider) GetIngestJob(ctx context.Context, ingestJobRidArg api.IngestJobRid) (api.IngestJob, error) {
	var defaultReturnVal api.IngestJob
	token, err := c.tokenProvider(ctx)
	if err != nil {
		return defaultReturnVal, err
	}
	return c.client.GetIngestJob(ctx, bearertoken.Token(token), ingestJobRidArg)
}

func (c *ingestInternalServiceClientWithTokenProvider) UpdateIngestJobStatus(ctx context.Context, ingestJobRidArg api.IngestJobRid, statusArg api.IngestJobStatus) (api.IngestJobStatus, error) {
	var defaultReturnVal api.IngestJobStatus
	token, err := c.tokenProvider(ctx)
	if err != nil {
		return defaultReturnVal, err
	}
	return c.client.UpdateIngestJobStatus(ctx, bearertoken.Token(token), ingestJobRidArg, statusArg)
}
