// Code generated by conjure-go. DO NOT EDIT.

package api

import (
	"context"
	"fmt"
	"net/url"

	"github.com/nominal-io/nominal-api-go/api/rids"
	"github.com/nominal-io/nominal-api-go/internal/conjureerrors"
	"github.com/palantir/conjure-go-runtime/v2/conjure-go-client/httpclient"
	"github.com/palantir/pkg/bearertoken"
	"github.com/palantir/pkg/datetime"
	werror "github.com/palantir/witchcraft-go-error"
)

// Manages data sources (logical groupings of series) that are stored by Nominal.
type NominalDataSourceServiceClient interface {
	// Creates a data source.
	Create(ctx context.Context, authHeader bearertoken.Token, requestArg CreateNominalDataSourceRequest) (NominalDataSource, error)
	Update(ctx context.Context, authHeader bearertoken.Token, ridArg rids.NominalDataSourceRid, requestArg UpdateNominalDataSourceRequest) (NominalDataSource, error)
	/*
	   Retrieves the data sources for the given data source RIDs.

	   Excludes data sources that do not exist or are unauthorized. A maximum of 1000 rids can be requested.
	*/
	BatchGet(ctx context.Context, authHeader bearertoken.Token, ridsArg []rids.NominalDataSourceRid) ([]NominalDataSource, error)
	// Sets the timestamp that the Nominal Data Source in question was last written to. Only needs to be called once per minute.
	UpdateLastWrittenTimestamp(ctx context.Context, authHeader bearertoken.Token, ridArg rids.NominalDataSourceRid, timestampArg datetime.DateTime) error
}

type nominalDataSourceServiceClient struct {
	client httpclient.Client
}

func NewNominalDataSourceServiceClient(client httpclient.Client) NominalDataSourceServiceClient {
	return &nominalDataSourceServiceClient{client: client}
}

func (c *nominalDataSourceServiceClient) Create(ctx context.Context, authHeader bearertoken.Token, requestArg CreateNominalDataSourceRequest) (NominalDataSource, error) {
	var defaultReturnVal NominalDataSource
	var returnVal *NominalDataSource
	var requestParams []httpclient.RequestParam
	requestParams = append(requestParams, httpclient.WithRPCMethodName("Create"))
	requestParams = append(requestParams, httpclient.WithRequestMethod("POST"))
	requestParams = append(requestParams, httpclient.WithHeader("Authorization", fmt.Sprint("Bearer ", authHeader)))
	requestParams = append(requestParams, httpclient.WithPathf("/storage/data-source/v1"))
	requestParams = append(requestParams, httpclient.WithJSONRequest(requestArg))
	requestParams = append(requestParams, httpclient.WithJSONResponse(&returnVal))
	requestParams = append(requestParams, httpclient.WithRequestConjureErrorDecoder(conjureerrors.Decoder()))
	if _, err := c.client.Do(ctx, requestParams...); err != nil {
		return defaultReturnVal, werror.WrapWithContextParams(ctx, err, "create failed")
	}
	if returnVal == nil {
		return defaultReturnVal, werror.ErrorWithContextParams(ctx, "create response cannot be nil")
	}
	return *returnVal, nil
}

func (c *nominalDataSourceServiceClient) Update(ctx context.Context, authHeader bearertoken.Token, ridArg rids.NominalDataSourceRid, requestArg UpdateNominalDataSourceRequest) (NominalDataSource, error) {
	var defaultReturnVal NominalDataSource
	var returnVal *NominalDataSource
	var requestParams []httpclient.RequestParam
	requestParams = append(requestParams, httpclient.WithRPCMethodName("Update"))
	requestParams = append(requestParams, httpclient.WithRequestMethod("PUT"))
	requestParams = append(requestParams, httpclient.WithHeader("Authorization", fmt.Sprint("Bearer ", authHeader)))
	requestParams = append(requestParams, httpclient.WithPathf("/storage/data-source/v1/%s", url.PathEscape(fmt.Sprint(ridArg))))
	requestParams = append(requestParams, httpclient.WithJSONRequest(requestArg))
	requestParams = append(requestParams, httpclient.WithJSONResponse(&returnVal))
	requestParams = append(requestParams, httpclient.WithRequestConjureErrorDecoder(conjureerrors.Decoder()))
	if _, err := c.client.Do(ctx, requestParams...); err != nil {
		return defaultReturnVal, werror.WrapWithContextParams(ctx, err, "update failed")
	}
	if returnVal == nil {
		return defaultReturnVal, werror.ErrorWithContextParams(ctx, "update response cannot be nil")
	}
	return *returnVal, nil
}

func (c *nominalDataSourceServiceClient) BatchGet(ctx context.Context, authHeader bearertoken.Token, ridsArg []rids.NominalDataSourceRid) ([]NominalDataSource, error) {
	var returnVal []NominalDataSource
	var requestParams []httpclient.RequestParam
	requestParams = append(requestParams, httpclient.WithRPCMethodName("BatchGet"))
	requestParams = append(requestParams, httpclient.WithRequestMethod("POST"))
	requestParams = append(requestParams, httpclient.WithHeader("Authorization", fmt.Sprint("Bearer ", authHeader)))
	requestParams = append(requestParams, httpclient.WithPathf("/storage/data-source/v1/batch-get"))
	requestParams = append(requestParams, httpclient.WithJSONRequest(ridsArg))
	requestParams = append(requestParams, httpclient.WithJSONResponse(&returnVal))
	requestParams = append(requestParams, httpclient.WithRequestConjureErrorDecoder(conjureerrors.Decoder()))
	if _, err := c.client.Do(ctx, requestParams...); err != nil {
		return nil, werror.WrapWithContextParams(ctx, err, "batchGet failed")
	}
	if returnVal == nil {
		return nil, werror.ErrorWithContextParams(ctx, "batchGet response cannot be nil")
	}
	return returnVal, nil
}

func (c *nominalDataSourceServiceClient) UpdateLastWrittenTimestamp(ctx context.Context, authHeader bearertoken.Token, ridArg rids.NominalDataSourceRid, timestampArg datetime.DateTime) error {
	var requestParams []httpclient.RequestParam
	requestParams = append(requestParams, httpclient.WithRPCMethodName("UpdateLastWrittenTimestamp"))
	requestParams = append(requestParams, httpclient.WithRequestMethod("PUT"))
	requestParams = append(requestParams, httpclient.WithHeader("Authorization", fmt.Sprint("Bearer ", authHeader)))
	requestParams = append(requestParams, httpclient.WithPathf("/storage/data-source/v1/%s/last-written", url.PathEscape(fmt.Sprint(ridArg))))
	requestParams = append(requestParams, httpclient.WithJSONRequest(timestampArg))
	requestParams = append(requestParams, httpclient.WithRequestConjureErrorDecoder(conjureerrors.Decoder()))
	if _, err := c.client.Do(ctx, requestParams...); err != nil {
		return werror.WrapWithContextParams(ctx, err, "updateLastWrittenTimestamp failed")
	}
	return nil
}

// Manages data sources (logical groupings of series) that are stored by Nominal.
type NominalDataSourceServiceClientWithAuth interface {
	// Creates a data source.
	Create(ctx context.Context, requestArg CreateNominalDataSourceRequest) (NominalDataSource, error)
	Update(ctx context.Context, ridArg rids.NominalDataSourceRid, requestArg UpdateNominalDataSourceRequest) (NominalDataSource, error)
	/*
	   Retrieves the data sources for the given data source RIDs.

	   Excludes data sources that do not exist or are unauthorized. A maximum of 1000 rids can be requested.
	*/
	BatchGet(ctx context.Context, ridsArg []rids.NominalDataSourceRid) ([]NominalDataSource, error)
	// Sets the timestamp that the Nominal Data Source in question was last written to. Only needs to be called once per minute.
	UpdateLastWrittenTimestamp(ctx context.Context, ridArg rids.NominalDataSourceRid, timestampArg datetime.DateTime) error
}

func NewNominalDataSourceServiceClientWithAuth(client NominalDataSourceServiceClient, authHeader bearertoken.Token) NominalDataSourceServiceClientWithAuth {
	return &nominalDataSourceServiceClientWithAuth{client: client, authHeader: authHeader}
}

type nominalDataSourceServiceClientWithAuth struct {
	client     NominalDataSourceServiceClient
	authHeader bearertoken.Token
}

func (c *nominalDataSourceServiceClientWithAuth) Create(ctx context.Context, requestArg CreateNominalDataSourceRequest) (NominalDataSource, error) {
	return c.client.Create(ctx, c.authHeader, requestArg)
}

func (c *nominalDataSourceServiceClientWithAuth) Update(ctx context.Context, ridArg rids.NominalDataSourceRid, requestArg UpdateNominalDataSourceRequest) (NominalDataSource, error) {
	return c.client.Update(ctx, c.authHeader, ridArg, requestArg)
}

func (c *nominalDataSourceServiceClientWithAuth) BatchGet(ctx context.Context, ridsArg []rids.NominalDataSourceRid) ([]NominalDataSource, error) {
	return c.client.BatchGet(ctx, c.authHeader, ridsArg)
}

func (c *nominalDataSourceServiceClientWithAuth) UpdateLastWrittenTimestamp(ctx context.Context, ridArg rids.NominalDataSourceRid, timestampArg datetime.DateTime) error {
	return c.client.UpdateLastWrittenTimestamp(ctx, c.authHeader, ridArg, timestampArg)
}

func NewNominalDataSourceServiceClientWithTokenProvider(client NominalDataSourceServiceClient, tokenProvider httpclient.TokenProvider) NominalDataSourceServiceClientWithAuth {
	return &nominalDataSourceServiceClientWithTokenProvider{client: client, tokenProvider: tokenProvider}
}

type nominalDataSourceServiceClientWithTokenProvider struct {
	client        NominalDataSourceServiceClient
	tokenProvider httpclient.TokenProvider
}

func (c *nominalDataSourceServiceClientWithTokenProvider) Create(ctx context.Context, requestArg CreateNominalDataSourceRequest) (NominalDataSource, error) {
	var defaultReturnVal NominalDataSource
	token, err := c.tokenProvider(ctx)
	if err != nil {
		return defaultReturnVal, err
	}
	return c.client.Create(ctx, bearertoken.Token(token), requestArg)
}

func (c *nominalDataSourceServiceClientWithTokenProvider) Update(ctx context.Context, ridArg rids.NominalDataSourceRid, requestArg UpdateNominalDataSourceRequest) (NominalDataSource, error) {
	var defaultReturnVal NominalDataSource
	token, err := c.tokenProvider(ctx)
	if err != nil {
		return defaultReturnVal, err
	}
	return c.client.Update(ctx, bearertoken.Token(token), ridArg, requestArg)
}

func (c *nominalDataSourceServiceClientWithTokenProvider) BatchGet(ctx context.Context, ridsArg []rids.NominalDataSourceRid) ([]NominalDataSource, error) {
	var defaultReturnVal []NominalDataSource
	token, err := c.tokenProvider(ctx)
	if err != nil {
		return defaultReturnVal, err
	}
	return c.client.BatchGet(ctx, bearertoken.Token(token), ridsArg)
}

func (c *nominalDataSourceServiceClientWithTokenProvider) UpdateLastWrittenTimestamp(ctx context.Context, ridArg rids.NominalDataSourceRid, timestampArg datetime.DateTime) error {
	token, err := c.tokenProvider(ctx)
	if err != nil {
		return err
	}
	return c.client.UpdateLastWrittenTimestamp(ctx, bearertoken.Token(token), ridArg, timestampArg)
}
