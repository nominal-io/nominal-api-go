// Code generated by conjure-go. DO NOT EDIT.

package seriescache

import (
	"context"
	"fmt"
	"net/url"

	"github.com/nominal-io/nominal-api-go/internal/conjureerrors"
	"github.com/nominal-io/nominal-api-go/io/nominal/api"
	api1 "github.com/nominal-io/nominal-api-go/timeseries/seriescache/api"
	"github.com/palantir/conjure-go-runtime/v2/conjure-go-client/httpclient"
	"github.com/palantir/pkg/bearertoken"
	werror "github.com/palantir/witchcraft-go-error"
)

// The Series Cache service manages internal chunks of data cached by Nominal's backend.
type SeriesCacheServiceClient interface {
	/*
	   Fetches "chunks" of series that are stored as Arrow files in S3.
	   This endpoint is being deprecated for new series in favor of batchGetCachedSeries
	*/
	GetChunks(ctx context.Context, authHeader bearertoken.Token, logicalSeriesRidArg api.LogicalSeriesRid, getChunksParametersArg api1.GetChunksParameters) (api1.GetChunksResponse, error)
	// Deprecated: Deprecated in favor of batchCreateChunks
	CreateChunks(ctx context.Context, authHeader bearertoken.Token, logicalSeriesRidArg api.LogicalSeriesRid, createChunksParametersArg api1.CreateChunksParameters) (api1.CreateChunksResponse, error)
	BatchCreateChunks(ctx context.Context, authHeader bearertoken.Token, requestArg api1.CreateChunksParameters) (api1.CreateChunksResponse, error)
	// Deletes the chunks that intersect the given time range. Does not delete the corresponding files from S3.
	DeleteChunks(ctx context.Context, authHeader bearertoken.Token, logicalSeriesRidArg api.LogicalSeriesRid, requestArg api1.DeleteChunksParameters) (api1.DeleteChunksResponse, error)
}

type seriesCacheServiceClient struct {
	client httpclient.Client
}

func NewSeriesCacheServiceClient(client httpclient.Client) SeriesCacheServiceClient {
	return &seriesCacheServiceClient{client: client}
}

func (c *seriesCacheServiceClient) GetChunks(ctx context.Context, authHeader bearertoken.Token, logicalSeriesRidArg api.LogicalSeriesRid, getChunksParametersArg api1.GetChunksParameters) (api1.GetChunksResponse, error) {
	var defaultReturnVal api1.GetChunksResponse
	var returnVal *api1.GetChunksResponse
	var requestParams []httpclient.RequestParam
	requestParams = append(requestParams, httpclient.WithRPCMethodName("GetChunks"))
	requestParams = append(requestParams, httpclient.WithRequestMethod("POST"))
	requestParams = append(requestParams, httpclient.WithHeader("Authorization", fmt.Sprint("Bearer ", authHeader)))
	requestParams = append(requestParams, httpclient.WithPathf("/timeseries/series-cache/v1/logical-series/%s/get-chunks", url.PathEscape(fmt.Sprint(logicalSeriesRidArg))))
	requestParams = append(requestParams, httpclient.WithJSONRequest(getChunksParametersArg))
	requestParams = append(requestParams, httpclient.WithJSONResponse(&returnVal))
	requestParams = append(requestParams, httpclient.WithRequestConjureErrorDecoder(conjureerrors.Decoder()))
	if _, err := c.client.Do(ctx, requestParams...); err != nil {
		return defaultReturnVal, werror.WrapWithContextParams(ctx, err, "getChunks failed")
	}
	if returnVal == nil {
		return defaultReturnVal, werror.ErrorWithContextParams(ctx, "getChunks response cannot be nil")
	}
	return *returnVal, nil
}

func (c *seriesCacheServiceClient) CreateChunks(ctx context.Context, authHeader bearertoken.Token, logicalSeriesRidArg api.LogicalSeriesRid, createChunksParametersArg api1.CreateChunksParameters) (api1.CreateChunksResponse, error) {
	var defaultReturnVal api1.CreateChunksResponse
	var returnVal *api1.CreateChunksResponse
	var requestParams []httpclient.RequestParam
	requestParams = append(requestParams, httpclient.WithRPCMethodName("CreateChunks"))
	requestParams = append(requestParams, httpclient.WithRequestMethod("POST"))
	requestParams = append(requestParams, httpclient.WithHeader("Authorization", fmt.Sprint("Bearer ", authHeader)))
	requestParams = append(requestParams, httpclient.WithPathf("/timeseries/series-cache/v1/logical-series/%s/create-chunks", url.PathEscape(fmt.Sprint(logicalSeriesRidArg))))
	requestParams = append(requestParams, httpclient.WithJSONRequest(createChunksParametersArg))
	requestParams = append(requestParams, httpclient.WithJSONResponse(&returnVal))
	requestParams = append(requestParams, httpclient.WithRequestConjureErrorDecoder(conjureerrors.Decoder()))
	if _, err := c.client.Do(ctx, requestParams...); err != nil {
		return defaultReturnVal, werror.WrapWithContextParams(ctx, err, "createChunks failed")
	}
	if returnVal == nil {
		return defaultReturnVal, werror.ErrorWithContextParams(ctx, "createChunks response cannot be nil")
	}
	return *returnVal, nil
}

func (c *seriesCacheServiceClient) BatchCreateChunks(ctx context.Context, authHeader bearertoken.Token, requestArg api1.CreateChunksParameters) (api1.CreateChunksResponse, error) {
	var defaultReturnVal api1.CreateChunksResponse
	var returnVal *api1.CreateChunksResponse
	var requestParams []httpclient.RequestParam
	requestParams = append(requestParams, httpclient.WithRPCMethodName("BatchCreateChunks"))
	requestParams = append(requestParams, httpclient.WithRequestMethod("POST"))
	requestParams = append(requestParams, httpclient.WithHeader("Authorization", fmt.Sprint("Bearer ", authHeader)))
	requestParams = append(requestParams, httpclient.WithPathf("/timeseries/series-cache/v1/batch-create-chunks"))
	requestParams = append(requestParams, httpclient.WithJSONRequest(requestArg))
	requestParams = append(requestParams, httpclient.WithJSONResponse(&returnVal))
	requestParams = append(requestParams, httpclient.WithRequestConjureErrorDecoder(conjureerrors.Decoder()))
	if _, err := c.client.Do(ctx, requestParams...); err != nil {
		return defaultReturnVal, werror.WrapWithContextParams(ctx, err, "batchCreateChunks failed")
	}
	if returnVal == nil {
		return defaultReturnVal, werror.ErrorWithContextParams(ctx, "batchCreateChunks response cannot be nil")
	}
	return *returnVal, nil
}

func (c *seriesCacheServiceClient) DeleteChunks(ctx context.Context, authHeader bearertoken.Token, logicalSeriesRidArg api.LogicalSeriesRid, requestArg api1.DeleteChunksParameters) (api1.DeleteChunksResponse, error) {
	var defaultReturnVal api1.DeleteChunksResponse
	var returnVal *api1.DeleteChunksResponse
	var requestParams []httpclient.RequestParam
	requestParams = append(requestParams, httpclient.WithRPCMethodName("DeleteChunks"))
	requestParams = append(requestParams, httpclient.WithRequestMethod("POST"))
	requestParams = append(requestParams, httpclient.WithHeader("Authorization", fmt.Sprint("Bearer ", authHeader)))
	requestParams = append(requestParams, httpclient.WithPathf("/timeseries/series-cache/v1/logical-series/%s/delete-chunks", url.PathEscape(fmt.Sprint(logicalSeriesRidArg))))
	requestParams = append(requestParams, httpclient.WithJSONRequest(requestArg))
	requestParams = append(requestParams, httpclient.WithJSONResponse(&returnVal))
	requestParams = append(requestParams, httpclient.WithRequestConjureErrorDecoder(conjureerrors.Decoder()))
	if _, err := c.client.Do(ctx, requestParams...); err != nil {
		return defaultReturnVal, werror.WrapWithContextParams(ctx, err, "deleteChunks failed")
	}
	if returnVal == nil {
		return defaultReturnVal, werror.ErrorWithContextParams(ctx, "deleteChunks response cannot be nil")
	}
	return *returnVal, nil
}

// The Series Cache service manages internal chunks of data cached by Nominal's backend.
type SeriesCacheServiceClientWithAuth interface {
	/*
	   Fetches "chunks" of series that are stored as Arrow files in S3.
	   This endpoint is being deprecated for new series in favor of batchGetCachedSeries
	*/
	GetChunks(ctx context.Context, logicalSeriesRidArg api.LogicalSeriesRid, getChunksParametersArg api1.GetChunksParameters) (api1.GetChunksResponse, error)
	// Deprecated: Deprecated in favor of batchCreateChunks
	CreateChunks(ctx context.Context, logicalSeriesRidArg api.LogicalSeriesRid, createChunksParametersArg api1.CreateChunksParameters) (api1.CreateChunksResponse, error)
	BatchCreateChunks(ctx context.Context, requestArg api1.CreateChunksParameters) (api1.CreateChunksResponse, error)
	// Deletes the chunks that intersect the given time range. Does not delete the corresponding files from S3.
	DeleteChunks(ctx context.Context, logicalSeriesRidArg api.LogicalSeriesRid, requestArg api1.DeleteChunksParameters) (api1.DeleteChunksResponse, error)
}

func NewSeriesCacheServiceClientWithAuth(client SeriesCacheServiceClient, authHeader bearertoken.Token) SeriesCacheServiceClientWithAuth {
	return &seriesCacheServiceClientWithAuth{client: client, authHeader: authHeader}
}

type seriesCacheServiceClientWithAuth struct {
	client     SeriesCacheServiceClient
	authHeader bearertoken.Token
}

func (c *seriesCacheServiceClientWithAuth) GetChunks(ctx context.Context, logicalSeriesRidArg api.LogicalSeriesRid, getChunksParametersArg api1.GetChunksParameters) (api1.GetChunksResponse, error) {
	return c.client.GetChunks(ctx, c.authHeader, logicalSeriesRidArg, getChunksParametersArg)
}

func (c *seriesCacheServiceClientWithAuth) CreateChunks(ctx context.Context, logicalSeriesRidArg api.LogicalSeriesRid, createChunksParametersArg api1.CreateChunksParameters) (api1.CreateChunksResponse, error) {
	return c.client.CreateChunks(ctx, c.authHeader, logicalSeriesRidArg, createChunksParametersArg)
}

func (c *seriesCacheServiceClientWithAuth) BatchCreateChunks(ctx context.Context, requestArg api1.CreateChunksParameters) (api1.CreateChunksResponse, error) {
	return c.client.BatchCreateChunks(ctx, c.authHeader, requestArg)
}

func (c *seriesCacheServiceClientWithAuth) DeleteChunks(ctx context.Context, logicalSeriesRidArg api.LogicalSeriesRid, requestArg api1.DeleteChunksParameters) (api1.DeleteChunksResponse, error) {
	return c.client.DeleteChunks(ctx, c.authHeader, logicalSeriesRidArg, requestArg)
}

func NewSeriesCacheServiceClientWithTokenProvider(client SeriesCacheServiceClient, tokenProvider httpclient.TokenProvider) SeriesCacheServiceClientWithAuth {
	return &seriesCacheServiceClientWithTokenProvider{client: client, tokenProvider: tokenProvider}
}

type seriesCacheServiceClientWithTokenProvider struct {
	client        SeriesCacheServiceClient
	tokenProvider httpclient.TokenProvider
}

func (c *seriesCacheServiceClientWithTokenProvider) GetChunks(ctx context.Context, logicalSeriesRidArg api.LogicalSeriesRid, getChunksParametersArg api1.GetChunksParameters) (api1.GetChunksResponse, error) {
	var defaultReturnVal api1.GetChunksResponse
	token, err := c.tokenProvider(ctx)
	if err != nil {
		return defaultReturnVal, err
	}
	return c.client.GetChunks(ctx, bearertoken.Token(token), logicalSeriesRidArg, getChunksParametersArg)
}

func (c *seriesCacheServiceClientWithTokenProvider) CreateChunks(ctx context.Context, logicalSeriesRidArg api.LogicalSeriesRid, createChunksParametersArg api1.CreateChunksParameters) (api1.CreateChunksResponse, error) {
	var defaultReturnVal api1.CreateChunksResponse
	token, err := c.tokenProvider(ctx)
	if err != nil {
		return defaultReturnVal, err
	}
	return c.client.CreateChunks(ctx, bearertoken.Token(token), logicalSeriesRidArg, createChunksParametersArg)
}

func (c *seriesCacheServiceClientWithTokenProvider) BatchCreateChunks(ctx context.Context, requestArg api1.CreateChunksParameters) (api1.CreateChunksResponse, error) {
	var defaultReturnVal api1.CreateChunksResponse
	token, err := c.tokenProvider(ctx)
	if err != nil {
		return defaultReturnVal, err
	}
	return c.client.BatchCreateChunks(ctx, bearertoken.Token(token), requestArg)
}

func (c *seriesCacheServiceClientWithTokenProvider) DeleteChunks(ctx context.Context, logicalSeriesRidArg api.LogicalSeriesRid, requestArg api1.DeleteChunksParameters) (api1.DeleteChunksResponse, error) {
	var defaultReturnVal api1.DeleteChunksResponse
	token, err := c.tokenProvider(ctx)
	if err != nil {
		return defaultReturnVal, err
	}
	return c.client.DeleteChunks(ctx, bearertoken.Token(token), logicalSeriesRidArg, requestArg)
}
