// Code generated by conjure-go. DO NOT EDIT.

package workspace

import (
	"context"
	"fmt"
	"net/url"

	"github.com/nominal-io/nominal-api-go/api/rids"
	"github.com/nominal-io/nominal-api-go/internal/conjureerrors"
	"github.com/palantir/conjure-go-runtime/v2/conjure-go-client/httpclient"
	"github.com/palantir/pkg/bearertoken"
	werror "github.com/palantir/witchcraft-go-error"
)

/*
This service provides information about workspaces. Workspaces provide access control boundaries. All resources in
Nominal live within a workspace.
*/
type WorkspaceServiceClient interface {
	// Gets all workspaces that the requesting user belongs to.
	GetWorkspaces(ctx context.Context, authHeader bearertoken.Token) ([]Workspace, error)
	// Gets the workspace with the specified WorkspaceRid.
	GetWorkspace(ctx context.Context, authHeader bearertoken.Token, workspaceRidArg rids.WorkspaceRid) (Workspace, error)
	// Updates the settings of the workspace with the specified WorkspaceRid.
	UpdateWorkspace(ctx context.Context, authHeader bearertoken.Token, ridArg rids.WorkspaceRid, requestArg UpdateWorkspaceRequest) (Workspace, error)
	/*
	   Gets the default workspace for the requesting user. If the user belongs to a single workspace,
	   that workspace is returned. Otherwise, if the user's organization has a default workspace and
	   the user belongs to it, that will be returned.
	*/
	GetDefaultWorkspace(ctx context.Context, authHeader bearertoken.Token) (*Workspace, error)
}

type workspaceServiceClient struct {
	client httpclient.Client
}

func NewWorkspaceServiceClient(client httpclient.Client) WorkspaceServiceClient {
	return &workspaceServiceClient{client: client}
}

func (c *workspaceServiceClient) GetWorkspaces(ctx context.Context, authHeader bearertoken.Token) ([]Workspace, error) {
	var returnVal []Workspace
	var requestParams []httpclient.RequestParam
	requestParams = append(requestParams, httpclient.WithRPCMethodName("GetWorkspaces"))
	requestParams = append(requestParams, httpclient.WithRequestMethod("GET"))
	requestParams = append(requestParams, httpclient.WithHeader("Authorization", fmt.Sprint("Bearer ", authHeader)))
	requestParams = append(requestParams, httpclient.WithPathf("/workspaces/v1/workspaces"))
	requestParams = append(requestParams, httpclient.WithJSONResponse(&returnVal))
	requestParams = append(requestParams, httpclient.WithRequestConjureErrorDecoder(conjureerrors.Decoder()))
	if _, err := c.client.Do(ctx, requestParams...); err != nil {
		return nil, werror.WrapWithContextParams(ctx, err, "getWorkspaces failed")
	}
	if returnVal == nil {
		return nil, werror.ErrorWithContextParams(ctx, "getWorkspaces response cannot be nil")
	}
	return returnVal, nil
}

func (c *workspaceServiceClient) GetWorkspace(ctx context.Context, authHeader bearertoken.Token, workspaceRidArg rids.WorkspaceRid) (Workspace, error) {
	var defaultReturnVal Workspace
	var returnVal *Workspace
	var requestParams []httpclient.RequestParam
	requestParams = append(requestParams, httpclient.WithRPCMethodName("GetWorkspace"))
	requestParams = append(requestParams, httpclient.WithRequestMethod("GET"))
	requestParams = append(requestParams, httpclient.WithHeader("Authorization", fmt.Sprint("Bearer ", authHeader)))
	requestParams = append(requestParams, httpclient.WithPathf("/workspaces/v1/workspaces/%s", url.PathEscape(fmt.Sprint(workspaceRidArg))))
	requestParams = append(requestParams, httpclient.WithJSONResponse(&returnVal))
	requestParams = append(requestParams, httpclient.WithRequestConjureErrorDecoder(conjureerrors.Decoder()))
	if _, err := c.client.Do(ctx, requestParams...); err != nil {
		return defaultReturnVal, werror.WrapWithContextParams(ctx, err, "getWorkspace failed")
	}
	if returnVal == nil {
		return defaultReturnVal, werror.ErrorWithContextParams(ctx, "getWorkspace response cannot be nil")
	}
	return *returnVal, nil
}

func (c *workspaceServiceClient) UpdateWorkspace(ctx context.Context, authHeader bearertoken.Token, ridArg rids.WorkspaceRid, requestArg UpdateWorkspaceRequest) (Workspace, error) {
	var defaultReturnVal Workspace
	var returnVal *Workspace
	var requestParams []httpclient.RequestParam
	requestParams = append(requestParams, httpclient.WithRPCMethodName("UpdateWorkspace"))
	requestParams = append(requestParams, httpclient.WithRequestMethod("PUT"))
	requestParams = append(requestParams, httpclient.WithHeader("Authorization", fmt.Sprint("Bearer ", authHeader)))
	requestParams = append(requestParams, httpclient.WithPathf("/workspaces/v1/workspaces/%s", url.PathEscape(fmt.Sprint(ridArg))))
	requestParams = append(requestParams, httpclient.WithJSONRequest(requestArg))
	requestParams = append(requestParams, httpclient.WithJSONResponse(&returnVal))
	requestParams = append(requestParams, httpclient.WithRequestConjureErrorDecoder(conjureerrors.Decoder()))
	if _, err := c.client.Do(ctx, requestParams...); err != nil {
		return defaultReturnVal, werror.WrapWithContextParams(ctx, err, "updateWorkspace failed")
	}
	if returnVal == nil {
		return defaultReturnVal, werror.ErrorWithContextParams(ctx, "updateWorkspace response cannot be nil")
	}
	return *returnVal, nil
}

func (c *workspaceServiceClient) GetDefaultWorkspace(ctx context.Context, authHeader bearertoken.Token) (*Workspace, error) {
	var returnVal *Workspace
	var requestParams []httpclient.RequestParam
	requestParams = append(requestParams, httpclient.WithRPCMethodName("GetDefaultWorkspace"))
	requestParams = append(requestParams, httpclient.WithRequestMethod("GET"))
	requestParams = append(requestParams, httpclient.WithHeader("Authorization", fmt.Sprint("Bearer ", authHeader)))
	requestParams = append(requestParams, httpclient.WithPathf("/workspaces/v1/default-workspace"))
	requestParams = append(requestParams, httpclient.WithJSONResponse(&returnVal))
	requestParams = append(requestParams, httpclient.WithRequestConjureErrorDecoder(conjureerrors.Decoder()))
	if _, err := c.client.Do(ctx, requestParams...); err != nil {
		return nil, werror.WrapWithContextParams(ctx, err, "getDefaultWorkspace failed")
	}
	return returnVal, nil
}

/*
This service provides information about workspaces. Workspaces provide access control boundaries. All resources in
Nominal live within a workspace.
*/
type WorkspaceServiceClientWithAuth interface {
	// Gets all workspaces that the requesting user belongs to.
	GetWorkspaces(ctx context.Context) ([]Workspace, error)
	// Gets the workspace with the specified WorkspaceRid.
	GetWorkspace(ctx context.Context, workspaceRidArg rids.WorkspaceRid) (Workspace, error)
	// Updates the settings of the workspace with the specified WorkspaceRid.
	UpdateWorkspace(ctx context.Context, ridArg rids.WorkspaceRid, requestArg UpdateWorkspaceRequest) (Workspace, error)
	/*
	   Gets the default workspace for the requesting user. If the user belongs to a single workspace,
	   that workspace is returned. Otherwise, if the user's organization has a default workspace and
	   the user belongs to it, that will be returned.
	*/
	GetDefaultWorkspace(ctx context.Context) (*Workspace, error)
}

func NewWorkspaceServiceClientWithAuth(client WorkspaceServiceClient, authHeader bearertoken.Token) WorkspaceServiceClientWithAuth {
	return &workspaceServiceClientWithAuth{client: client, authHeader: authHeader}
}

type workspaceServiceClientWithAuth struct {
	client     WorkspaceServiceClient
	authHeader bearertoken.Token
}

func (c *workspaceServiceClientWithAuth) GetWorkspaces(ctx context.Context) ([]Workspace, error) {
	return c.client.GetWorkspaces(ctx, c.authHeader)
}

func (c *workspaceServiceClientWithAuth) GetWorkspace(ctx context.Context, workspaceRidArg rids.WorkspaceRid) (Workspace, error) {
	return c.client.GetWorkspace(ctx, c.authHeader, workspaceRidArg)
}

func (c *workspaceServiceClientWithAuth) UpdateWorkspace(ctx context.Context, ridArg rids.WorkspaceRid, requestArg UpdateWorkspaceRequest) (Workspace, error) {
	return c.client.UpdateWorkspace(ctx, c.authHeader, ridArg, requestArg)
}

func (c *workspaceServiceClientWithAuth) GetDefaultWorkspace(ctx context.Context) (*Workspace, error) {
	return c.client.GetDefaultWorkspace(ctx, c.authHeader)
}

func NewWorkspaceServiceClientWithTokenProvider(client WorkspaceServiceClient, tokenProvider httpclient.TokenProvider) WorkspaceServiceClientWithAuth {
	return &workspaceServiceClientWithTokenProvider{client: client, tokenProvider: tokenProvider}
}

type workspaceServiceClientWithTokenProvider struct {
	client        WorkspaceServiceClient
	tokenProvider httpclient.TokenProvider
}

func (c *workspaceServiceClientWithTokenProvider) GetWorkspaces(ctx context.Context) ([]Workspace, error) {
	var defaultReturnVal []Workspace
	token, err := c.tokenProvider(ctx)
	if err != nil {
		return defaultReturnVal, err
	}
	return c.client.GetWorkspaces(ctx, bearertoken.Token(token))
}

func (c *workspaceServiceClientWithTokenProvider) GetWorkspace(ctx context.Context, workspaceRidArg rids.WorkspaceRid) (Workspace, error) {
	var defaultReturnVal Workspace
	token, err := c.tokenProvider(ctx)
	if err != nil {
		return defaultReturnVal, err
	}
	return c.client.GetWorkspace(ctx, bearertoken.Token(token), workspaceRidArg)
}

func (c *workspaceServiceClientWithTokenProvider) UpdateWorkspace(ctx context.Context, ridArg rids.WorkspaceRid, requestArg UpdateWorkspaceRequest) (Workspace, error) {
	var defaultReturnVal Workspace
	token, err := c.tokenProvider(ctx)
	if err != nil {
		return defaultReturnVal, err
	}
	return c.client.UpdateWorkspace(ctx, bearertoken.Token(token), ridArg, requestArg)
}

func (c *workspaceServiceClientWithTokenProvider) GetDefaultWorkspace(ctx context.Context) (*Workspace, error) {
	var defaultReturnVal *Workspace
	token, err := c.tokenProvider(ctx)
	if err != nil {
		return defaultReturnVal, err
	}
	return c.client.GetDefaultWorkspace(ctx, bearertoken.Token(token))
}
