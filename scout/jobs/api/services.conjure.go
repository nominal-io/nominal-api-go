// Code generated by conjure-go. DO NOT EDIT.

package api

import (
	"context"
	"fmt"
	"net/url"

	"github.com/nominal-io/nominal-api-go/internal/conjureerrors"
	"github.com/nominal-io/nominal-api-go/scout/checks/api"
	"github.com/nominal-io/nominal-api-go/scout/checks/api1"
	"github.com/palantir/conjure-go-runtime/v2/conjure-go-client/httpclient"
	"github.com/palantir/pkg/bearertoken"
	werror "github.com/palantir/witchcraft-go-error"
)

// The Internal Job Service is responsible for running jobs for checklist executions.
type InternalJobServiceClient interface {
	// Runs the requested job specs.
	SubmitJobs(ctx context.Context, authHeader bearertoken.Token, requestArg api.SubmitJobsRequest) (api.SubmitJobsResponse, error)
}

type internalJobServiceClient struct {
	client httpclient.Client
}

func NewInternalJobServiceClient(client httpclient.Client) InternalJobServiceClient {
	return &internalJobServiceClient{client: client}
}

func (c *internalJobServiceClient) SubmitJobs(ctx context.Context, authHeader bearertoken.Token, requestArg api.SubmitJobsRequest) (api.SubmitJobsResponse, error) {
	var defaultReturnVal api.SubmitJobsResponse
	var returnVal *api.SubmitJobsResponse
	var requestParams []httpclient.RequestParam
	requestParams = append(requestParams, httpclient.WithRPCMethodName("SubmitJobs"))
	requestParams = append(requestParams, httpclient.WithRequestMethod("POST"))
	requestParams = append(requestParams, httpclient.WithHeader("Authorization", fmt.Sprint("Bearer ", authHeader)))
	requestParams = append(requestParams, httpclient.WithPathf("/internal/jobs/v1/submitJobs"))
	requestParams = append(requestParams, httpclient.WithJSONRequest(requestArg))
	requestParams = append(requestParams, httpclient.WithJSONResponse(&returnVal))
	requestParams = append(requestParams, httpclient.WithRequestConjureErrorDecoder(conjureerrors.Decoder()))
	if _, err := c.client.Do(ctx, requestParams...); err != nil {
		return defaultReturnVal, werror.WrapWithContextParams(ctx, err, "submitJobs failed")
	}
	if returnVal == nil {
		return defaultReturnVal, werror.ErrorWithContextParams(ctx, "submitJobs response cannot be nil")
	}
	return *returnVal, nil
}

// The Internal Job Service is responsible for running jobs for checklist executions.
type InternalJobServiceClientWithAuth interface {
	// Runs the requested job specs.
	SubmitJobs(ctx context.Context, requestArg api.SubmitJobsRequest) (api.SubmitJobsResponse, error)
}

func NewInternalJobServiceClientWithAuth(client InternalJobServiceClient, authHeader bearertoken.Token) InternalJobServiceClientWithAuth {
	return &internalJobServiceClientWithAuth{client: client, authHeader: authHeader}
}

type internalJobServiceClientWithAuth struct {
	client     InternalJobServiceClient
	authHeader bearertoken.Token
}

func (c *internalJobServiceClientWithAuth) SubmitJobs(ctx context.Context, requestArg api.SubmitJobsRequest) (api.SubmitJobsResponse, error) {
	return c.client.SubmitJobs(ctx, c.authHeader, requestArg)
}

func NewInternalJobServiceClientWithTokenProvider(client InternalJobServiceClient, tokenProvider httpclient.TokenProvider) InternalJobServiceClientWithAuth {
	return &internalJobServiceClientWithTokenProvider{client: client, tokenProvider: tokenProvider}
}

type internalJobServiceClientWithTokenProvider struct {
	client        InternalJobServiceClient
	tokenProvider httpclient.TokenProvider
}

func (c *internalJobServiceClientWithTokenProvider) SubmitJobs(ctx context.Context, requestArg api.SubmitJobsRequest) (api.SubmitJobsResponse, error) {
	var defaultReturnVal api.SubmitJobsResponse
	token, err := c.tokenProvider(ctx)
	if err != nil {
		return defaultReturnVal, err
	}
	return c.client.SubmitJobs(ctx, bearertoken.Token(token), requestArg)
}

// The Job Service is responsible for returning information about jobs for checklist executions.
type JobServiceClient interface {
	// Fetches the job report for a job RID. Throws ResourcesNotFound if no job exists with this job RID.
	GetJobReport(ctx context.Context, authHeader bearertoken.Token, jobRidArg api.JobRid) (api1.JobReport, error)
	/*
	   Fetches the job reports for a set of job RIDs. Omits any job reports the user is not permitted to see from
	   the response.
	*/
	BatchGetJobReports(ctx context.Context, authHeader bearertoken.Token, requestArg api.BatchGetJobReportsRequest) (api1.BatchGetJobReportsResponse, error)
}

type jobServiceClient struct {
	client httpclient.Client
}

func NewJobServiceClient(client httpclient.Client) JobServiceClient {
	return &jobServiceClient{client: client}
}

func (c *jobServiceClient) GetJobReport(ctx context.Context, authHeader bearertoken.Token, jobRidArg api.JobRid) (api1.JobReport, error) {
	var defaultReturnVal api1.JobReport
	var returnVal *api1.JobReport
	var requestParams []httpclient.RequestParam
	requestParams = append(requestParams, httpclient.WithRPCMethodName("GetJobReport"))
	requestParams = append(requestParams, httpclient.WithRequestMethod("GET"))
	requestParams = append(requestParams, httpclient.WithHeader("Authorization", fmt.Sprint("Bearer ", authHeader)))
	requestParams = append(requestParams, httpclient.WithPathf("/jobs/v1/%s/job-report", url.PathEscape(fmt.Sprint(jobRidArg))))
	requestParams = append(requestParams, httpclient.WithJSONResponse(&returnVal))
	requestParams = append(requestParams, httpclient.WithRequestConjureErrorDecoder(conjureerrors.Decoder()))
	if _, err := c.client.Do(ctx, requestParams...); err != nil {
		return defaultReturnVal, werror.WrapWithContextParams(ctx, err, "getJobReport failed")
	}
	if returnVal == nil {
		return defaultReturnVal, werror.ErrorWithContextParams(ctx, "getJobReport response cannot be nil")
	}
	return *returnVal, nil
}

func (c *jobServiceClient) BatchGetJobReports(ctx context.Context, authHeader bearertoken.Token, requestArg api.BatchGetJobReportsRequest) (api1.BatchGetJobReportsResponse, error) {
	var defaultReturnVal api1.BatchGetJobReportsResponse
	var returnVal *api1.BatchGetJobReportsResponse
	var requestParams []httpclient.RequestParam
	requestParams = append(requestParams, httpclient.WithRPCMethodName("BatchGetJobReports"))
	requestParams = append(requestParams, httpclient.WithRequestMethod("POST"))
	requestParams = append(requestParams, httpclient.WithHeader("Authorization", fmt.Sprint("Bearer ", authHeader)))
	requestParams = append(requestParams, httpclient.WithPathf("/jobs/v1/batch-get-job-reports"))
	requestParams = append(requestParams, httpclient.WithJSONRequest(requestArg))
	requestParams = append(requestParams, httpclient.WithJSONResponse(&returnVal))
	requestParams = append(requestParams, httpclient.WithRequestConjureErrorDecoder(conjureerrors.Decoder()))
	if _, err := c.client.Do(ctx, requestParams...); err != nil {
		return defaultReturnVal, werror.WrapWithContextParams(ctx, err, "batchGetJobReports failed")
	}
	if returnVal == nil {
		return defaultReturnVal, werror.ErrorWithContextParams(ctx, "batchGetJobReports response cannot be nil")
	}
	return *returnVal, nil
}

// The Job Service is responsible for returning information about jobs for checklist executions.
type JobServiceClientWithAuth interface {
	// Fetches the job report for a job RID. Throws ResourcesNotFound if no job exists with this job RID.
	GetJobReport(ctx context.Context, jobRidArg api.JobRid) (api1.JobReport, error)
	/*
	   Fetches the job reports for a set of job RIDs. Omits any job reports the user is not permitted to see from
	   the response.
	*/
	BatchGetJobReports(ctx context.Context, requestArg api.BatchGetJobReportsRequest) (api1.BatchGetJobReportsResponse, error)
}

func NewJobServiceClientWithAuth(client JobServiceClient, authHeader bearertoken.Token) JobServiceClientWithAuth {
	return &jobServiceClientWithAuth{client: client, authHeader: authHeader}
}

type jobServiceClientWithAuth struct {
	client     JobServiceClient
	authHeader bearertoken.Token
}

func (c *jobServiceClientWithAuth) GetJobReport(ctx context.Context, jobRidArg api.JobRid) (api1.JobReport, error) {
	return c.client.GetJobReport(ctx, c.authHeader, jobRidArg)
}

func (c *jobServiceClientWithAuth) BatchGetJobReports(ctx context.Context, requestArg api.BatchGetJobReportsRequest) (api1.BatchGetJobReportsResponse, error) {
	return c.client.BatchGetJobReports(ctx, c.authHeader, requestArg)
}

func NewJobServiceClientWithTokenProvider(client JobServiceClient, tokenProvider httpclient.TokenProvider) JobServiceClientWithAuth {
	return &jobServiceClientWithTokenProvider{client: client, tokenProvider: tokenProvider}
}

type jobServiceClientWithTokenProvider struct {
	client        JobServiceClient
	tokenProvider httpclient.TokenProvider
}

func (c *jobServiceClientWithTokenProvider) GetJobReport(ctx context.Context, jobRidArg api.JobRid) (api1.JobReport, error) {
	var defaultReturnVal api1.JobReport
	token, err := c.tokenProvider(ctx)
	if err != nil {
		return defaultReturnVal, err
	}
	return c.client.GetJobReport(ctx, bearertoken.Token(token), jobRidArg)
}

func (c *jobServiceClientWithTokenProvider) BatchGetJobReports(ctx context.Context, requestArg api.BatchGetJobReportsRequest) (api1.BatchGetJobReportsResponse, error) {
	var defaultReturnVal api1.BatchGetJobReportsResponse
	token, err := c.tokenProvider(ctx)
	if err != nil {
		return defaultReturnVal, err
	}
	return c.client.BatchGetJobReports(ctx, bearertoken.Token(token), requestArg)
}
