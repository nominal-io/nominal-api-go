// Code generated by conjure-go. DO NOT EDIT.

package api

import (
	"context"
	"fmt"

	"github.com/palantir/pkg/safejson"
	"github.com/palantir/pkg/safeyaml"
)

type OffsetAnchor struct {
	typ    string
	run    *OffsetRunAnchor
	series *OffsetSeriesAnchor
}

type offsetAnchorDeserializer struct {
	Type   string              `json:"type"`
	Run    *OffsetRunAnchor    `json:"run"`
	Series *OffsetSeriesAnchor `json:"series"`
}

func (u *offsetAnchorDeserializer) toStruct() OffsetAnchor {
	return OffsetAnchor{typ: u.Type, run: u.Run, series: u.Series}
}

func (u *OffsetAnchor) toSerializer() (interface{}, error) {
	switch u.typ {
	default:
		return nil, fmt.Errorf("unknown type %q", u.typ)
	case "run":
		if u.run == nil {
			return nil, fmt.Errorf("field \"run\" is required")
		}
		return struct {
			Type string          `json:"type"`
			Run  OffsetRunAnchor `json:"run"`
		}{Type: "run", Run: *u.run}, nil
	case "series":
		if u.series == nil {
			return nil, fmt.Errorf("field \"series\" is required")
		}
		return struct {
			Type   string             `json:"type"`
			Series OffsetSeriesAnchor `json:"series"`
		}{Type: "series", Series: *u.series}, nil
	}
}

func (u OffsetAnchor) MarshalJSON() ([]byte, error) {
	ser, err := u.toSerializer()
	if err != nil {
		return nil, err
	}
	return safejson.Marshal(ser)
}

func (u *OffsetAnchor) UnmarshalJSON(data []byte) error {
	var deser offsetAnchorDeserializer
	if err := safejson.Unmarshal(data, &deser); err != nil {
		return err
	}
	*u = deser.toStruct()
	switch u.typ {
	case "run":
		if u.run == nil {
			return fmt.Errorf("field \"run\" is required")
		}
	case "series":
		if u.series == nil {
			return fmt.Errorf("field \"series\" is required")
		}
	}
	return nil
}

func (u OffsetAnchor) MarshalYAML() (interface{}, error) {
	jsonBytes, err := safejson.Marshal(u)
	if err != nil {
		return nil, err
	}
	return safeyaml.JSONtoYAMLMapSlice(jsonBytes)
}

func (u *OffsetAnchor) UnmarshalYAML(unmarshal func(interface{}) error) error {
	jsonBytes, err := safeyaml.UnmarshalerToJSONBytes(unmarshal)
	if err != nil {
		return err
	}
	return safejson.Unmarshal(jsonBytes, *&u)
}

func (u *OffsetAnchor) AcceptFuncs(runFunc func(OffsetRunAnchor) error, seriesFunc func(OffsetSeriesAnchor) error, unknownFunc func(string) error) error {
	switch u.typ {
	default:
		if u.typ == "" {
			return fmt.Errorf("invalid value in union type")
		}
		return unknownFunc(u.typ)
	case "run":
		if u.run == nil {
			return fmt.Errorf("field \"run\" is required")
		}
		return runFunc(*u.run)
	case "series":
		if u.series == nil {
			return fmt.Errorf("field \"series\" is required")
		}
		return seriesFunc(*u.series)
	}
}

func (u *OffsetAnchor) RunNoopSuccess(OffsetRunAnchor) error {
	return nil
}

func (u *OffsetAnchor) SeriesNoopSuccess(OffsetSeriesAnchor) error {
	return nil
}

func (u *OffsetAnchor) ErrorOnUnknown(typeName string) error {
	return fmt.Errorf("invalid value in union type. Type name: %s", typeName)
}

func (u *OffsetAnchor) Accept(v OffsetAnchorVisitor) error {
	switch u.typ {
	default:
		if u.typ == "" {
			return fmt.Errorf("invalid value in union type")
		}
		return v.VisitUnknown(u.typ)
	case "run":
		if u.run == nil {
			return fmt.Errorf("field \"run\" is required")
		}
		return v.VisitRun(*u.run)
	case "series":
		if u.series == nil {
			return fmt.Errorf("field \"series\" is required")
		}
		return v.VisitSeries(*u.series)
	}
}

type OffsetAnchorVisitor interface {
	VisitRun(v OffsetRunAnchor) error
	VisitSeries(v OffsetSeriesAnchor) error
	VisitUnknown(typeName string) error
}

func (u *OffsetAnchor) AcceptWithContext(ctx context.Context, v OffsetAnchorVisitorWithContext) error {
	switch u.typ {
	default:
		if u.typ == "" {
			return fmt.Errorf("invalid value in union type")
		}
		return v.VisitUnknownWithContext(ctx, u.typ)
	case "run":
		if u.run == nil {
			return fmt.Errorf("field \"run\" is required")
		}
		return v.VisitRunWithContext(ctx, *u.run)
	case "series":
		if u.series == nil {
			return fmt.Errorf("field \"series\" is required")
		}
		return v.VisitSeriesWithContext(ctx, *u.series)
	}
}

type OffsetAnchorVisitorWithContext interface {
	VisitRunWithContext(ctx context.Context, v OffsetRunAnchor) error
	VisitSeriesWithContext(ctx context.Context, v OffsetSeriesAnchor) error
	VisitUnknownWithContext(ctx context.Context, typeName string) error
}

func NewOffsetAnchorFromRun(v OffsetRunAnchor) OffsetAnchor {
	return OffsetAnchor{typ: "run", run: &v}
}

func NewOffsetAnchorFromSeries(v OffsetSeriesAnchor) OffsetAnchor {
	return OffsetAnchor{typ: "series", series: &v}
}
