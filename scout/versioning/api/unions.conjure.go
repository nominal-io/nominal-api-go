// Code generated by conjure-go. DO NOT EDIT.

package api

import (
	"context"
	"fmt"

	"github.com/palantir/pkg/safejson"
	"github.com/palantir/pkg/safeyaml"
)

// Needs to be expressible as a database query
type CompactionStrategy struct {
	typ           string
	olderThanDays *int
}

type compactionStrategyDeserializer struct {
	Type          string `json:"type"`
	OlderThanDays *int   `json:"olderThanDays"`
}

func (u *compactionStrategyDeserializer) toStruct() CompactionStrategy {
	return CompactionStrategy{typ: u.Type, olderThanDays: u.OlderThanDays}
}

func (u *CompactionStrategy) toSerializer() (interface{}, error) {
	switch u.typ {
	default:
		return nil, fmt.Errorf("unknown type %q", u.typ)
	case "olderThanDays":
		if u.olderThanDays == nil {
			return nil, fmt.Errorf("field \"olderThanDays\" is required")
		}
		return struct {
			Type          string `json:"type"`
			OlderThanDays int    `json:"olderThanDays"`
		}{Type: "olderThanDays", OlderThanDays: *u.olderThanDays}, nil
	}
}

func (u CompactionStrategy) MarshalJSON() ([]byte, error) {
	ser, err := u.toSerializer()
	if err != nil {
		return nil, err
	}
	return safejson.Marshal(ser)
}

func (u *CompactionStrategy) UnmarshalJSON(data []byte) error {
	var deser compactionStrategyDeserializer
	if err := safejson.Unmarshal(data, &deser); err != nil {
		return err
	}
	*u = deser.toStruct()
	switch u.typ {
	case "olderThanDays":
		if u.olderThanDays == nil {
			return fmt.Errorf("field \"olderThanDays\" is required")
		}
	}
	return nil
}

func (u CompactionStrategy) MarshalYAML() (interface{}, error) {
	jsonBytes, err := safejson.Marshal(u)
	if err != nil {
		return nil, err
	}
	return safeyaml.JSONtoYAMLMapSlice(jsonBytes)
}

func (u *CompactionStrategy) UnmarshalYAML(unmarshal func(interface{}) error) error {
	jsonBytes, err := safeyaml.UnmarshalerToJSONBytes(unmarshal)
	if err != nil {
		return err
	}
	return safejson.Unmarshal(jsonBytes, *&u)
}

func (u *CompactionStrategy) AcceptFuncs(olderThanDaysFunc func(int) error, unknownFunc func(string) error) error {
	switch u.typ {
	default:
		if u.typ == "" {
			return fmt.Errorf("invalid value in union type")
		}
		return unknownFunc(u.typ)
	case "olderThanDays":
		if u.olderThanDays == nil {
			return fmt.Errorf("field \"olderThanDays\" is required")
		}
		return olderThanDaysFunc(*u.olderThanDays)
	}
}

func (u *CompactionStrategy) OlderThanDaysNoopSuccess(int) error {
	return nil
}

func (u *CompactionStrategy) ErrorOnUnknown(typeName string) error {
	return fmt.Errorf("invalid value in union type. Type name: %s", typeName)
}

func (u *CompactionStrategy) Accept(v CompactionStrategyVisitor) error {
	switch u.typ {
	default:
		if u.typ == "" {
			return fmt.Errorf("invalid value in union type")
		}
		return v.VisitUnknown(u.typ)
	case "olderThanDays":
		if u.olderThanDays == nil {
			return fmt.Errorf("field \"olderThanDays\" is required")
		}
		return v.VisitOlderThanDays(*u.olderThanDays)
	}
}

type CompactionStrategyVisitor interface {
	VisitOlderThanDays(v int) error
	VisitUnknown(typeName string) error
}

func (u *CompactionStrategy) AcceptWithContext(ctx context.Context, v CompactionStrategyVisitorWithContext) error {
	switch u.typ {
	default:
		if u.typ == "" {
			return fmt.Errorf("invalid value in union type")
		}
		return v.VisitUnknownWithContext(ctx, u.typ)
	case "olderThanDays":
		if u.olderThanDays == nil {
			return fmt.Errorf("field \"olderThanDays\" is required")
		}
		return v.VisitOlderThanDaysWithContext(ctx, *u.olderThanDays)
	}
}

type CompactionStrategyVisitorWithContext interface {
	VisitOlderThanDaysWithContext(ctx context.Context, v int) error
	VisitUnknownWithContext(ctx context.Context, typeName string) error
}

func NewCompactionStrategyFromOlderThanDays(v int) CompactionStrategy {
	return CompactionStrategy{typ: "olderThanDays", olderThanDays: &v}
}
